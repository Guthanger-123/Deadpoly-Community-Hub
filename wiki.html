<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DeadPoly Community Hub — Wiki</title>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-GD7LNZHQMM"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-GD7LNZHQMM');
  </script>

  <style>
    :root{
      --bg:#0b0b0f;
      --panel:#14141b;
      --panel2:#101016;
      --text:#f2f2f2;
      --muted:#b7b7c2;
      --line:#2a2a36;
      --btn:#1c1c26;
      --btnHover:#242434;
      --good:#3cff9a;
      --warn:#ffd36a;
      --bad:#ff5a73;
      --shadow: 0 20px 60px rgba(0,0,0,.45);
      --radius:16px;
    }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;}
    a{color:inherit}
    *{box-sizing:border-box}

    /* Top bar (match your look) */
    .topbar{
      position:sticky;top:0;z-index:999;
      background:linear-gradient(to bottom, rgba(10,10,14,.92), rgba(10,10,14,.68));
      backdrop-filter: blur(8px);
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .topbar-inner{
      max-width:1400px;margin:0 auto;padding:10px 14px;
      display:flex;gap:10px;align-items:center;justify-content:space-between;
    }
    .leftbar{display:flex;gap:10px;align-items:center}
    .brand{
      display:flex;align-items:baseline;gap:10px;
      font-weight:700;letter-spacing:.2px
    }
    .brand small{font-weight:500;color:var(--muted)}
    .rightbar{display:flex;gap:10px;align-items:center}

    .btn{
      display:inline-flex;align-items:center;gap:8px;
      background:var(--btn);border:1px solid rgba(255,255,255,.10);color:var(--text);
      padding:8px 10px;border-radius:12px;text-decoration:none;
      transition:transform .08s ease, background .12s ease;
      user-select:none;
    }
    .btn:hover{background:var(--btnHover)}
    .btn:active{transform:scale(.98)}
    .btn.icon{padding:8px 10px}
    .btn.primary{border-color:rgba(255,255,255,.18);background:rgba(255,255,255,.08)}
    .btn.primary:hover{background:rgba(255,255,255,.12)}

    /* Layout */
    .wrap{max-width:1400px;margin:0 auto;padding:14px 14px 34px}
    .grid{
      display:grid;
      grid-template-columns: 330px 1fr;
      gap:12px;
      align-items:start;
    }

    /* left panel */
    .panel{
      background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
      border:1px solid rgba(255,255,255,.10);
      border-radius:var(--radius);
      box-shadow: var(--shadow);
    }
    .panel .hd{
      padding:12px 12px 10px;
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .panel .hd h3{margin:0;font-size:14px}
    .panel .hd p{margin:4px 0 0;color:var(--muted);font-size:12px}

    .nav{
      padding:10px;
      display:flex;flex-direction:column;gap:10px;
    }

    .section{
      border:1px solid rgba(255,255,255,.08);
      border-radius:14px;
      background:rgba(0,0,0,.18);
      overflow:hidden;
    }
    .section summary{
      list-style:none;
      cursor:pointer;
      padding:10px 10px;
      display:flex;align-items:center;justify-content:space-between;
      font-weight:700;
    }
    .section summary::-webkit-details-marker{display:none}
    .section .body{
      padding:0 10px 10px;
      border-top:1px solid rgba(255,255,255,.08);
      color:var(--muted);
      font-size:12px;
    }
    .pillrow{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px}
    .pill{
      display:inline-flex;
      padding:6px 10px;border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.05);
      text-decoration:none;
      color:var(--text);
      font-size:12px;
      transition:background .12s ease, transform .12s ease;
    }
    .pill:hover{background:rgba(255,255,255,.10);transform:translateY(-1px)}
    .muted{color:var(--muted)}

    /* main */
    .main{
      padding:12px;
    }
    .hero{
      border-radius:var(--radius);
      border:1px solid rgba(255,255,255,.10);
      background:
        radial-gradient(1200px 600px at 20% 10%, rgba(75,120,255,.20), transparent 60%),
        radial-gradient(1200px 600px at 90% 0%, rgba(255,255,255,.08), transparent 55%),
        rgba(0,0,0,.18);
      padding:14px;
      box-shadow: var(--shadow);
    }
    .hero-top{
      display:flex;justify-content:space-between;align-items:flex-start;gap:10px;flex-wrap:wrap;
    }
    .hero h1{margin:0;font-size:22px;letter-spacing:.2px}
    .hero p{margin:6px 0 0;color:var(--muted);max-width:820px}

    .searchrow{
      margin-top:12px;
      display:flex;gap:10px;align-items:center;flex-wrap:wrap;
    }
    .search{
      flex:1;min-width:240px;
      background:rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.10);
      border-radius:12px;
      padding:10px 12px;
      color:var(--text);
      outline:none;
    }
    .kbd{
      font-size:12px;color:var(--muted);
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.04);
      padding:6px 10px;border-radius:10px;
    }

    .cards{
      margin-top:12px;
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
      gap:10px;
    }
    .card{
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.18);
      border-radius:16px;
      padding:12px;
      transition:transform .12s ease, background .12s ease;
      position:relative;
      overflow:hidden;
    }
    .card:hover{transform:translateY(-2px);background:rgba(0,0,0,.24)}
    .card h3{margin:0 0 6px;font-size:15px}
    .card p{margin:0;color:var(--muted);font-size:12px}
    .tag{
      margin-top:10px;
      display:inline-flex;
      font-size:12px;
      padding:4px 8px;border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.05);
      color:var(--muted);
    }

    .split{
      margin-top:12px;
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    .contentPanel{
      padding:12px;
      border-radius:var(--radius);
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.18);
      box-shadow: var(--shadow);
    }
    .contentPanel h2{margin:0 0 6px;font-size:16px}
    .contentPanel .sub{color:var(--muted);font-size:12px;margin-bottom:10px}

    .list{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
      gap:8px;
    }
    .itemlink{
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      padding:10px 10px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.04);
      text-decoration:none;
      transition:transform .12s ease, background .12s ease;
    }
    .itemlink:hover{transform:translateY(-1px);background:rgba(255,255,255,.07)}
    .itemlink span{color:var(--muted);font-size:12px}

    /* Right drawer toggle */
    .drawerToggle{
      position:fixed;
      right:14px;
      bottom:14px;
      z-index:1001;
    }
    .drawerToggle .btn{box-shadow: var(--shadow)}
    body.drawer-open .grid{grid-template-columns: 280px 1fr;} /* wiki gets a bit more room */
    body.drawer-open .drawer{transform:translateX(0)}
    .drawer{
      position:fixed;
      top:56px; /* below topbar */
      right:0;
      width:360px;
      height:calc(100vh - 56px);
      z-index:1000;
      transform:translateX(105%);
      transition:transform .18s ease;
      padding:12px;
    }
    .drawer .panel{height:100%;display:flex;flex-direction:column;overflow:hidden}
    .drawer .panel .body{
      padding:12px;
      overflow:auto;
    }

    .statusRow{
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      padding:10px 12px;
      border-top:1px solid rgba(255,255,255,.08);
      color:var(--muted);
      font-size:12px;
    }

    /* Viewer modal */
    .modal{
      position:fixed;inset:0;
      background:rgba(0,0,0,.65);
      z-index:2000;
      display:none;
      align-items:center;
      justify-content:center;
      padding:14px;
    }
    .modal.show{display:flex}
    .modalCard{
      width:min(1100px, 96vw);
      height:min(700px, 88vh);
      border-radius:18px;
      border:1px solid rgba(255,255,255,.12);
      background:
        radial-gradient(1200px 700px at 30% 0%, rgba(75,120,255,.20), transparent 60%),
        rgba(10,10,14,.92);
      box-shadow: var(--shadow);
      overflow:hidden;
      display:grid;
      grid-template-columns: 1fr 320px;
    }
    .stageWrap{
      position:relative;
      border-right:1px solid rgba(255,255,255,.08);
    }
    #stage{
      position:absolute;inset:0;
    }
    .stageHud{
      position:absolute;left:12px;top:12px;
      display:flex;gap:10px;align-items:center;flex-wrap:wrap;
      z-index:10;
    }
    .badge{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 10px;border-radius:12px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.35);
      font-size:12px;
      color:var(--muted);
    }
    .dot{width:8px;height:8px;border-radius:999px;background:var(--warn)}
    .badge.ok .dot{background:var(--good)}
    .badge.bad .dot{background:var(--bad)}
    .badge.hidden{display:none}

    .sideControls{
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:10px;
      overflow:auto;
    }
    .sideControls h3{margin:0;font-size:14px}
    .note{
      color:var(--muted);
      font-size:12px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.04);
      border-radius:14px;
      padding:10px;
    }
    .row{
      display:flex;gap:8px;flex-wrap:wrap
    }
    .btn.block{width:100%;justify-content:center}
    .small{font-size:12px;color:var(--muted)}

    @media (max-width: 980px){
      .grid{grid-template-columns: 1fr}
      .drawer{width:min(92vw, 420px)}
      body.drawer-open .grid{grid-template-columns: 1fr}
      .modalCard{grid-template-columns:1fr}
      .stageWrap{border-right:none;border-bottom:1px solid rgba(255,255,255,.08)}
    }
  </style>
</head>

<body>
  <!-- TOP BAR -->
  <div class="topbar">
    <div class="topbar-inner">
      <div class="leftbar">
        <a class="btn" href="index.html">← Menu</a>
        <div class="brand">Wiki <small>Knowledge Base</small></div>
      </div>

      <div class="muted" style="font-size:12px">Search • Quick links • Rebuild notes</div>

      <div class="rightbar">
        <a class="btn" href="tips.html">Tips</a>
        <a class="btn" href="map.html">Maps</a>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="grid">
      <!-- LEFT NAV -->
      <aside class="panel">
        <div class="hd">
          <h3>Wiki Categories</h3>
          <p>Official wiki nav + community “Rebuild” links in one place.</p>
        </div>

        <div class="nav">
          <details class="section" open>
            <summary>Official Items <span class="muted">+</span></summary>
            <div class="body">
              These match the official wiki navigation.
              <div class="pillrow">
                <a class="pill" target="_blank" rel="noopener" href="https://deadpoly.wiki/Helmets">Helmets ↗</a>
                <a class="pill" target="_blank" rel="noopener" href="https://deadpoly.wiki/Masks">Masks ↗</a>
                <a class="pill" target="_blank" rel="noopener" href="https://deadpoly.wiki/Weapons">Weapons ↗</a>
                <a class="pill" target="_blank" rel="noopener" href="https://deadpoly.wiki/Armor">Armor ↗</a>
                <a class="pill" target="_blank" rel="noopener" href="https://deadpoly.wiki/Ammo">Ammo ↗</a>
                <a class="pill" target="_blank" rel="noopener" href="https://deadpoly.wiki/Backpacks">Backpacks ↗</a>
                <a class="pill" target="_blank" rel="noopener" href="https://deadpoly.wiki/Storage">Storage ↗</a>
                <a class="pill" target="_blank" rel="noopener" href="https://deadpoly.wiki/Accessories">Accessories ↗</a>
                <a class="pill" target="_blank" rel="noopener" href="https://deadpoly.wiki/Collectibles">Collectibles ↗</a>
                <a class="pill" target="_blank" rel="noopener" href="https://deadpoly.wiki/Crafting_Stations">Crafting Stations ↗</a>
                <a class="pill" target="_blank" rel="noopener" href="https://deadpoly.wiki/Consumables">Consumables ↗</a>
                <a class="pill" target="_blank" rel="noopener" href="https://deadpoly.wiki/Map">Map ↗</a>
              </div>
            </div>
          </details>

          <details class="section">
            <summary>Guides <span class="muted">+</span></summary>
            <div class="body">
              Put your “how-to” pages here (routes, bunkers, economy, trader loops).
              <div class="pillrow">
                <a class="pill" href="#guides">Open Guides Hub</a>
                <a class="pill" href="tips.html">Quick Tips</a>
              </div>
            </div>
          </details>

          <details class="section">
            <summary>Maps & Bunkers <span class="muted">+</span></summary>
            <div class="body">
              Your interactive maps live in this hub.
              <div class="pillrow">
                <a class="pill" href="map.html">Maps Page</a>
                <a class="pill" target="_blank" rel="noopener" href="https://deadpoly.fandom.com/wiki/Deadpoly_%28Rebuild%29_Wiki">Community TOC ↗</a>
              </div>
            </div>
          </details>

          <details class="section">
            <summary>Official Links <span class="muted">+</span></summary>
            <div class="body">
              Official DeadPoly links (from the official wiki).
              <div class="pillrow">
                <a class="pill" target="_blank" rel="noopener" href="https://deadpoly.com">DeadPoly.com ↗</a>
                <a class="pill" target="_blank" rel="noopener" href="https://discord.gg">Discord ↗</a>
                <a class="pill" target="_blank" rel="noopener" href="https://store.steampowered.com">Steam ↗</a>
              </div>
            </div>
          </details>
        </div>
      </aside>

      <!-- MAIN -->
      <main class="main">
        <div class="hero">
          <div class="hero-top">
            <div>
              <h1>DeadPoly Wiki</h1>
              <p>
                This page is your clean “hub wiki”: fast links to the official DeadPoly wiki plus community/Rebuild pages.
                The official wiki nav includes helmets, masks, weapons, armor, ammo, and more. :contentReference[oaicite:2]{index=2}
              </p>
              <p class="muted" style="margin-top:6px">
                Tip: The community/Rebuild wiki has a big table of contents (maps, tutorials, vehicles, traders, quests, patch notes). :contentReference[oaicite:3]{index=3}
              </p>
            </div>

            <div class="row">
              <button class="btn primary" id="openViewerBtn">Open 3D Viewer</button>
              <a class="btn" target="_blank" rel="noopener" href="https://deadpoly.wiki/Main_Page">Official Wiki ↗</a>
              <a class="btn" target="_blank" rel="noopener" href="https://deadpoly.fandom.com/wiki/Deadpoly_%28Rebuild%29_Wiki">Rebuild Wiki ↗</a>
            </div>
          </div>

          <div class="searchrow">
            <input id="q" class="search" placeholder="Search this hub (ex: helmets, traders, delta, quests, patch notes)..." />
            <div class="kbd">Tip: use the drawer (bottom-right) for “Model / Dresser”</div>
          </div>
        </div>

        <div class="cards" id="quickCards"></div>

        <div class="split">
          <section class="contentPanel" id="guides">
            <h2>Guides Hub</h2>
            <div class="sub">Add your own internal guides here (beginner routes, bunker clears, trader loops, base builds).</div>

            <div class="list">
              <a class="itemlink" href="tips.html"><div><strong>Tips & Tricks</strong><div class="muted">Short, fast survival notes</div></div><span>open</span></a>
              <a class="itemlink" href="map.html"><div><strong>Maps</strong><div class="muted">Interactive maps + bunker layers</div></div><span>open</span></a>
              <a class="itemlink" target="_blank" rel="noopener" href="https://deadpoly.fandom.com/wiki/Controls"><div><strong>Controls</strong><div class="muted">Community controls / keybind notes</div></div><span>↗</span></a>
              <a class="itemlink" target="_blank" rel="noopener" href="https://deadpoly.fandom.com/wiki/Patch_Notes"><div><strong>Patch Notes</strong><div class="muted">Community patch log</div></div><span>↗</span></a>
            </div>
          </section>

          <section class="contentPanel">
            <h2>Official Item Pages (fast)</h2>
            <div class="sub">These mirror the official wiki’s main navigation. :contentReference[oaicite:4]{index=4}</div>

            <div class="list">
              <a class="itemlink" target="_blank" rel="noopener" href="https://deadpoly.wiki/Helmets"><div><strong>Helmets</strong><div class="muted">Head protection / variants</div></div><span>↗</span></a>
              <a class="itemlink" target="_blank" rel="noopener" href="https://deadpoly.wiki/Masks"><div><strong>Masks</strong><div class="muted">Masks / face items</div></div><span>↗</span></a>
              <a class="itemlink" target="_blank" rel="noopener" href="https://deadpoly.wiki/Weapons"><div><strong>Weapons</strong><div class="muted">Melee & firearms</div></div><span>↗</span></a>
              <a class="itemlink" target="_blank" rel="noopener" href="https://deadpoly.wiki/Armor"><div><strong>Armor</strong><div class="muted">Body armor</div></div><span>↗</span></a>
              <a class="itemlink" target="_blank" rel="noopener" href="https://deadpoly.wiki/Ammo"><div><strong>Ammo</strong><div class="muted">Ammo types</div></div><span>↗</span></a>
              <a class="itemlink" target="_blank" rel="noopener" href="https://deadpoly.wiki/Backpacks"><div><strong>Backpacks</strong><div class="muted">Carry capacity</div></div><span>↗</span></a>
              <a class="itemlink" target="_blank" rel="noopener" href="https://deadpoly.wiki/Consumables"><div><strong>Consumables</strong><div class="muted">Food/meds/etc.</div></div><span>↗</span></a>
              <a class="itemlink" target="_blank" rel="noopener" href="https://deadpoly.wiki/Crafting_Stations"><div><strong>Crafting Stations</strong><div class="muted">Workstations</div></div><span>↗</span></a>
            </div>
          </section>

          <section class="contentPanel">
            <h2>Rebuild / Community Pages (fast)</h2>
            <div class="sub">These match common categories shown in the community TOC (maps, vehicles, traders, quests, etc.). :contentReference[oaicite:5]{index=5}</div>

            <div class="list">
              <a class="itemlink" target="_blank" rel="noopener" href="https://deadpoly.fandom.com/wiki/Vehicles"><div><strong>Vehicles</strong><div class="muted">Spawns / usage tips</div></div><span>↗</span></a>
              <a class="itemlink" target="_blank" rel="noopener" href="https://deadpoly.fandom.com/wiki/Traders"><div><strong>Traders</strong><div class="muted">Buy/sell loops</div></div><span>↗</span></a>
              <a class="itemlink" target="_blank" rel="noopener" href="https://deadpoly.fandom.com/wiki/Quests"><div><strong>Quests</strong><div class="muted">Quest chains / notes</div></div><span>↗</span></a>
              <a class="itemlink" target="_blank" rel="noopener" href="https://deadpoly.fandom.com/wiki/Achievements"><div><strong>Achievements</strong><div class="muted">Progress targets</div></div><span>↗</span></a>
            </div>
          </section>

          <section class="contentPanel">
            <h2>Why you sometimes see “blank” in 3D</h2>
            <div class="sub">If you open the viewer and load FBX but it’s invisible/black, it’s usually one of these:</div>

            <div class="list">
              <div class="itemlink" style="cursor:default">
                <div><strong>Git LFS pointer file</strong><div class="muted">You uploaded an LFS “pointer” instead of the real FBX bytes</div></div>
                <span>common</span>
              </div>
              <div class="itemlink" style="cursor:default">
                <div><strong>Camera framing / scale</strong><div class="muted">Model loads but is tiny/huge; needs auto-frame</div></div>
                <span>fixable</span>
              </div>
              <div class="itemlink" style="cursor:default">
                <div><strong>No lights / no materials</strong><div class="muted">Model is there but renders dark; add lights + material fallback</div></div>
                <span>fixable</span>
              </div>
            </div>
          </section>
        </div>
      </main>
    </div>
  </div>

  <!-- Drawer toggle -->
  <div class="drawerToggle">
    <button class="btn primary" id="drawerBtn">⟷ Model / Dresser</button>
  </div>

  <!-- Right Drawer (WIP, but doesn’t block wiki) -->
  <aside class="drawer" aria-hidden="true" id="drawer">
    <div class="panel">
      <div class="hd">
        <h3>Model Showcase / Character Dresser</h3>
        <p>Pop-out tools (kept separate so your wiki always works).</p>
      </div>

      <div class="body">
        <div class="note">
          <strong>Current status:</strong> The dresser UI is intentionally “WIP”.
          Use <b>Open 3D Viewer</b> to test FBX loading. Once the FBX truly loads, the WIP badge disappears.
        </div>

        <div class="row" style="margin-top:10px">
          <button class="btn block primary" id="openViewerBtn2">Open 3D Viewer</button>
          <a class="btn block" href="map.html">Maps</a>
          <a class="btn block" href="tips.html">Tips</a>
        </div>

        <div class="note" style="margin-top:10px">
          <div class="small"><b>FBX path used for quick test:</b></div>
          <div class="small"><code>assets/models/SK_BaseModel.fbx</code></div>
          <div class="small" style="margin-top:8px">
            If GitHub “Raw” shows <code>version https://git-lfs.github.com/spec/v1</code>, your FBX is an LFS pointer and won’t load.
          </div>
        </div>
      </div>

      <div class="statusRow">
        <span class="muted">Drawer: toggle with button</span>
        <button class="btn icon" id="closeDrawerBtn" title="Close drawer">→</button>
      </div>
    </div>
  </aside>

  <!-- 3D VIEWER MODAL -->
  <div class="modal" id="viewerModal" aria-hidden="true">
    <div class="modalCard" role="dialog" aria-modal="true" aria-label="3D Viewer">
      <div class="stageWrap">
        <div class="stageHud">
          <div class="badge" id="wipBadge">
            <span class="dot"></span>
            <span><b>WIP</b> — 3D loads are being wired up.</span>
          </div>
          <button class="btn" id="closeViewerBtn">Close</button>
          <button class="btn" id="fsBtn">Fullscreen</button>
        </div>
        <div id="stage"></div>
      </div>

      <div class="sideControls">
        <h3>Viewer Controls</h3>
        <div class="note">
          Drag = rotate • Scroll = zoom • Right-drag = pan
        </div>

        <button class="btn block primary" id="loadBaseBtn">Load Base FBX</button>
        <button class="btn block" id="resetCamBtn">Reset View</button>
        <button class="btn block" id="clearBtn">Clear Scene</button>

        <div class="note">
          <div class="small"><b>Status:</b> <span id="statusText">Ready.</span></div>
          <div class="small" style="margin-top:8px"><b>Tip:</b> If it loads but looks dark, we apply a basic material fallback automatically.</div>
        </div>

        <div class="note">
          <div class="small"><b>If nothing shows:</b></div>
          <div class="small">Open DevTools → Network: confirm the FBX returns 200 and is not “(from disk cache) pointer text”.</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script>
    // --- Quick cards (feel more alive) ---
    const quickCards = [
      { title:"Official Item Wiki", desc:"Helmets, masks, weapons, armor, ammo, etc. (official nav).", tag:"official", href:"https://deadpoly.wiki/Main_Page" },
      { title:"Rebuild / Community Wiki", desc:"Big TOC for maps, tutorials, traders, quests, patch notes.", tag:"community", href:"https://deadpoly.fandom.com/wiki/Deadpoly_%28Rebuild%29_Wiki" },
      { title:"Interactive Maps", desc:"Your hub maps + bunker layers.", tag:"hub", href:"map.html" },
      { title:"Tips & Tricks", desc:"Fast notes and survival habits.", tag:"hub", href:"tips.html" },
      { title:"3D Viewer (Beta)", desc:"Load your FBX (shows WIP until a real FBX loads).", tag:"beta", href:"#viewer" },
    ];

    const cardsEl = document.getElementById("quickCards");
    cardsEl.innerHTML = quickCards.map(c => `
      <a class="card" href="${c.href}" ${c.href.startsWith("http") ? 'target="_blank" rel="noopener"' : ''}>
        <h3>${escapeHtml(c.title)}</h3>
        <p>${escapeHtml(c.desc)}</p>
        <div class="tag">${escapeHtml(c.tag)}</div>
      </a>
    `).join("");

    // --- Search filter (this hub page only) ---
    const qEl = document.getElementById("q");
    qEl.addEventListener("input", () => {
      const q = qEl.value.trim().toLowerCase();
      [...cardsEl.querySelectorAll(".card")].forEach(card => {
        const text = card.innerText.toLowerCase();
        card.style.display = text.includes(q) ? "" : "none";
      });
    });

    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
    }

    // --- Drawer behavior ---
    const drawerBtn = document.getElementById("drawerBtn");
    const closeDrawerBtn = document.getElementById("closeDrawerBtn");
    function toggleDrawer(force){
      const open = (typeof force === "boolean") ? force : !document.body.classList.contains("drawer-open");
      document.body.classList.toggle("drawer-open", open);
      document.getElementById("drawer").setAttribute("aria-hidden", String(!open));
      drawerBtn.textContent = open ? "⟷ Close Drawer" : "⟷ Model / Dresser";
    }
    drawerBtn.addEventListener("click", () => toggleDrawer());
    closeDrawerBtn.addEventListener("click", () => toggleDrawer(false));

    // --- Viewer modal ---
    const viewerModal = document.getElementById("viewerModal");
    const openViewerBtn = document.getElementById("openViewerBtn");
    const openViewerBtn2 = document.getElementById("openViewerBtn2");
    const closeViewerBtn = document.getElementById("closeViewerBtn");
    const statusText = document.getElementById("statusText");
    const wipBadge = document.getElementById("wipBadge");

    function openViewer(){
      viewerModal.classList.add("show");
      viewerModal.setAttribute("aria-hidden","false");
      // ensure renderer sizes correctly (after modal is visible)
      setTimeout(() => window.__dp3d && window.__dp3d.resize(), 30);
    }
    function closeViewer(){
      viewerModal.classList.remove("show");
      viewerModal.setAttribute("aria-hidden","true");
      // exit fullscreen if active
      if (document.fullscreenElement) document.exitFullscreen().catch(()=>{});
    }
    openViewerBtn.addEventListener("click", (e)=>{ e.preventDefault(); openViewer(); });
    openViewerBtn2.addEventListener("click", (e)=>{ e.preventDefault(); openViewer(); });
    closeViewerBtn.addEventListener("click", closeViewer);
    viewerModal.addEventListener("click", (e)=>{ if(e.target === viewerModal) closeViewer(); });

    // ---------- THREE.JS + FBX LOADER ----------
    // Uses ES modules via CDN. Works on GitHub Pages (https) without local downloads.
    // IMPORTANT: opening this file via file:// may break module loading. Use GitHub Pages URL.
  </script>

  <script type="module">
    import * as THREE from "https://unpkg.com/three@0.160.0/build/three.module.js";
    import { OrbitControls } from "https://unpkg.com/three@0.160.0/examples/jsm/controls/OrbitControls.js";
    import { FBXLoader } from "https://unpkg.com/three@0.160.0/examples/jsm/loaders/FBXLoader.js";

    const stage = document.getElementById("stage");
    const loadBaseBtn = document.getElementById("loadBaseBtn");
    const resetCamBtn = document.getElementById("resetCamBtn");
    const clearBtn = document.getElementById("clearBtn");
    const fsBtn = document.getElementById("fsBtn");

    // Scene
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x0b0b0f);

    const camera = new THREE.PerspectiveCamera(50, 1, 0.01, 5000);
    camera.position.set(0, 1.6, 3.2);

    const renderer = new THREE.WebGLRenderer({ antialias:true, alpha:false });
    renderer.setPixelRatio(Math.min(devicePixelRatio, 2));
    stage.appendChild(renderer.domElement);

    // Controls
    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.target.set(0, 1.1, 0);

    // Lights (enough to avoid black silhouettes)
    const hemi = new THREE.HemisphereLight(0xffffff, 0x202030, 0.85);
    scene.add(hemi);

    const key = new THREE.DirectionalLight(0xffffff, 1.1);
    key.position.set(4, 8, 3);
    key.castShadow = false;
    scene.add(key);

    const fill = new THREE.DirectionalLight(0xffffff, 0.45);
    fill.position.set(-3, 4, -6);
    scene.add(fill);

    // Helpers
    const grid = new THREE.GridHelper(10, 10, 0x2a2a36, 0x1c1c26);
    grid.position.y = 0;
    scene.add(grid);

    let loadedGroup = new THREE.Group();
    scene.add(loadedGroup);

    function setStatus(msg){ statusText.textContent = msg; }

    function resize(){
      const r = stage.getBoundingClientRect();
      const w = Math.max(10, r.width);
      const h = Math.max(10, r.height);
      renderer.setSize(w, h, false);
      camera.aspect = w / h;
      camera.updateProjectionMatrix();
    }
    window.addEventListener("resize", resize);

    function resetView(){
      controls.target.set(0, 1.1, 0);
      camera.position.set(0, 1.6, 3.2);
      controls.update();
    }

    function clearScene(){
      loadedGroup.traverse(obj=>{
        if (obj.isMesh){
          if (obj.geometry) obj.geometry.dispose();
          if (obj.material){
            const mats = Array.isArray(obj.material) ? obj.material : [obj.material];
            mats.forEach(m=>{
              for (const k in m){
                const v = m[k];
                if (v && v.isTexture) v.dispose();
              }
              m.dispose?.();
            });
          }
        }
      });
      scene.remove(loadedGroup);
      loadedGroup = new THREE.Group();
      scene.add(loadedGroup);
      setStatus("Cleared.");
      // show WIP again until next successful FBX load
      wipBadge.classList.remove("hidden","ok","bad");
      wipBadge.classList.add("badge");
      wipBadge.querySelector("span:nth-child(2)").innerHTML = "<b>WIP</b> — 3D loads are being wired up.";
      wipBadge.querySelector(".dot").style.background = "";
    }

    function frameObject(obj){
      const box = new THREE.Box3().setFromObject(obj);
      const size = new THREE.Vector3();
      const center = new THREE.Vector3();
      box.getSize(size);
      box.getCenter(center);

      const maxDim = Math.max(size.x, size.y, size.z);
      const dist = maxDim * 1.3;

      controls.target.copy(center);

      camera.position.set(center.x, center.y + maxDim * 0.25, center.z + dist);
      camera.near = Math.max(0.01, dist / 500);
      camera.far = Math.max(2000, dist * 10);
      camera.updateProjectionMatrix();
      controls.update();
    }

    // Material fallback: converts any weird materials to MeshStandardMaterial so it’s visible.
    function applyFallbackMaterials(root){
      root.traverse(obj=>{
        if (!obj.isMesh) return;
        const old = obj.material;
        const mats = Array.isArray(old) ? old : [old];
        const newMats = mats.map(m=>{
          // keep color if any
          const color = (m && m.color) ? m.color : new THREE.Color(0xd0d0d6);
          const nm = new THREE.MeshStandardMaterial({
            color,
            metalness: 0.05,
            roughness: 0.85
          });
          return nm;
        });
        obj.material = Array.isArray(old) ? newMats : newMats[0];
      });
    }

    // Detect Git LFS pointer text (common GitHub Pages issue)
    async function looksLikeLFSPointer(url){
      try{
        const res = await fetch(url, { method:"GET" });
        const ct = (res.headers.get("content-type") || "").toLowerCase();
        // If FBX is served as text/plain or small, read a bit
        if (ct.includes("text") || ct.includes("plain") || ct.includes("json")){
          const t = await res.text();
          return t.includes("git-lfs.github.com/spec/v1");
        }
        // Sometimes still binary ct but pointer is tiny
        const buf = await res.arrayBuffer();
        if (buf.byteLength < 3000){
          const text = new TextDecoder().decode(buf);
          return text.includes("git-lfs.github.com/spec/v1");
        }
      }catch(e){}
      return false;
    }

    async function loadFBX(url){
      setStatus("Loading FBX…");
      // If it's an LFS pointer, warn clearly
      if (await looksLikeLFSPointer(url)){
        setStatus("FAILED: Git LFS pointer detected (not the real FBX).");
        wipBadge.classList.remove("hidden");
        wipBadge.classList.add("bad");
        wipBadge.querySelector(".dot").style.background = "";
        wipBadge.querySelector("span:nth-child(2)").innerHTML =
          "<b>ERROR</b> — Git LFS pointer file detected. Upload real FBX bytes (disable LFS for models or ensure LFS is served).";
        return;
      }

      const loader = new FBXLoader();
      loader.load(
        url,
        (obj)=>{
          clearScene();
          applyFallbackMaterials(obj);
          loadedGroup.add(obj);
          frameObject(obj);

          setStatus("Loaded ✓");
          // Hide WIP on success
          wipBadge.classList.add("hidden");
        },
        (xhr)=>{
          if (xhr && xhr.total){
            const pct = Math.round((xhr.loaded / xhr.total) * 100);
            setStatus(`Loading… ${pct}%`);
          }else{
            setStatus("Loading…");
          }
        },
        (err)=>{
          console.error(err);
          setStatus("FAILED: check DevTools Console/Network.");
          wipBadge.classList.remove("hidden");
          wipBadge.classList.add("bad");
          wipBadge.querySelector("span:nth-child(2)").innerHTML =
            "<b>ERROR</b> — FBX failed to load. Check Network for 404/CORS or file path case mismatch.";
        }
      );
    }

    // Fullscreen button (works reliably)
    fsBtn.addEventListener("click", async ()=>{
      try{
        const el = document.querySelector(".stageWrap");
        if (!document.fullscreenElement){
          await el.requestFullscreen();
        }else{
          await document.exitFullscreen();
        }
        setTimeout(resize, 50);
      }catch(e){
        setStatus("Fullscreen blocked by browser.");
      }
    });

    loadBaseBtn.addEventListener("click", ()=>{
      // Your stated base path
      loadFBX("assets/models/SK_BaseModel.fbx");
    });
    resetCamBtn.addEventListener("click", resetView);
    clearBtn.addEventListener("click", clearScene);

    function animate(){
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }

    // init
    window.__dp3d = { resize };
    resize();
    resetView();
    animate();
    setStatus("Ready.");
  </script>
</body>
</html>
