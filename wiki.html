<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>DeadPoly Wiki – 3D Preview</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- THREE CORE -->
<script src="https://unpkg.com/three@0.158.0/build/three.min.js"></script>
<script src="https://unpkg.com/three@0.158.0/examples/js/controls/OrbitControls.js"></script>
<script src="https://unpkg.com/three@0.158.0/examples/js/loaders/FBXLoader.js"></script>

<style>
html, body {
  margin:0;
  height:100%;
  background:#0b0d12;
  color:#fff;
  font-family:system-ui;
}

.topbar {
  height:50px;
  display:flex;
  align-items:center;
  padding:0 16px;
  border-bottom:1px solid #222;
}

.topbar a {
  color:#ccc;
  text-decoration:none;
  margin-right:16px;
}

#container {
  display:grid;
  grid-template-columns: 1fr 320px;
  height: calc(100% - 50px);
}

#viewer {
  position:relative;
  width:100%;
  height:100%;
}

.sidebar {
  border-left:1px solid #222;
  padding:12px;
}

button {
  width:100%;
  padding:10px;
  margin-bottom:8px;
  background:#1b1f2a;
  border:1px solid #333;
  color:#fff;
  border-radius:6px;
  cursor:pointer;
}

button:hover { background:#242a3a; }
</style>
</head>

<body>

<div class="topbar">
  <a href="index.html">← Menu</a>
  <strong>Wiki – 3D Viewer</strong>
</div>

<div id="container">
  <div id="viewer"></div>

  <div class="sidebar">
    <button onclick="loadBase()">Load Base Model</button>
    <button onclick="clearScene()">Clear Scene</button>

    <p style="font-size:12px;color:#aaa;">
      If you see a grid + light, Three.js is working.<br>
      If the FBX loads, your model path is correct.
    </p>
  </div>
</div>

<script>
/* ================= SCENE ================= */
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x0b0d12);

/* ================= CAMERA ================= */
const camera = new THREE.PerspectiveCamera(
  60,
  1,
  0.1,
  5000
);
camera.position.set(0, 150, 300);

/* ================= RENDERER ================= */
const renderer = new THREE.WebGLRenderer({ antialias:true });
renderer.setPixelRatio(window.devicePixelRatio);
renderer.setSize(100, 100); // temp
document.getElementById('viewer').appendChild(renderer.domElement);

/* ================= CONTROLS ================= */
const controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.target.set(0, 120, 0);

/* ================= LIGHTS ================= */
scene.add(new THREE.AmbientLight(0xffffff, 0.6));

const dir = new THREE.DirectionalLight(0xffffff, 1);
dir.position.set(200, 300, 200);
scene.add(dir);

/* ================= GRID (DEBUG – SHOULD ALWAYS SHOW) ================= */
const grid = new THREE.GridHelper(500, 20, 0x444444, 0x222222);
scene.add(grid);

/* ================= FBX ================= */
const loader = new THREE.FBXLoader();
let baseModel = null;

function loadBase() {
  loader.load(
    'assets/models/SK_BaseModel.fbx',
    fbx => {
      if (baseModel) scene.remove(baseModel);

      fbx.scale.setScalar(0.1);
      fbx.position.set(0, 0, 0);
      baseModel = fbx;
      scene.add(fbx);

      console.log('FBX loaded');
    },
    xhr => {
      console.log(`Loading FBX: ${(xhr.loaded / xhr.total * 100).toFixed(0)}%`);
    },
    err => {
      console.error('FBX ERROR', err);
      alert('FBX failed to load. Check path & filename.');
    }
  );
}

function clearScene() {
  if (baseModel) scene.remove(baseModel);
  baseModel = null;
}

/* ================= RESIZE FIX ================= */
function resize() {
  const viewer = document.getElementById('viewer');
  const w = viewer.clientWidth;
  const h = viewer.clientHeight;
  camera.aspect = w / h;
  camera.updateProjectionMatrix();
  renderer.setSize(w, h);
}
window.addEventListener('resize', resize);
resize();

/* ================= LOOP ================= */
function animate() {
  requestAnimationFrame(animate);
  controls.update();
  renderer.render(scene, camera);
}
animate();
</script>

</body>
</html>
